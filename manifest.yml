# Example language specification

# foobar:
#   template_files:
#     - Dockerfile # automatically added if not included
#     - .env
#   defaults:
#     sqlite_version: 3
#   versions:
#     '3':
#       sqlite_version: 2 # overrides the 3 from defaults above
#     '4':

# Coordinate with owner(s) of canvadocs before upgrades (currently the Content team)
appliances/libreoffice:
  defaults:
    ubuntu_version: bionic
  versions:
    '6.2':
      full_version: '6.2.7.1'
    '6.3':
      full_version: '6.3.1.2'

appliances/debugging:
  versions:
    bionic: {}
    focal: {}

clojure:
  versions:
    '11':
      java_version: '11'
      lein_version: '2.9.1'
      package_sha: 'a4c239b407576f94e2fef5bfa107f0d3f97d0b19c253b08860d9609df4ab8b29'
      jar_sha: 'ea7c831a4f5c38b6fc3926c6ad32d1d4b9b91bf830a715ecff5a70a18bda55f8'

core:
  defaults:
    flavor: slim
  versions:
    bionic:
      base_image:
        name: ubuntu:bionic
        source: dockerhub
      flavor: fat
    bionic-slim:
      base_image:
        name: ubuntu:bionic
        source: dockerhub
    focal:
      base_image:
        name: ubuntu:focal
        source: dockerhub
      multiarch: true
    jammy:
      base_image:
        name: ubuntu:jammy
        source: dockerhub
      multiarch: true

# Packages from https://go.dev/dl/ go<ver>.linux-amd64.tar.gz
golang:
  defaults:
    base_image: instructure/core:focal
  versions:
    '1.16':  # supported until 1.18 is out
      full_version: '1.16.15'
      package_sha: '77c782a633186d78c384f972fb113a43c24be0234c42fef22c2d8c4c4c8e7475'
    '1.17':  # supported until 1.19 is out
      full_version: '1.17.12'
      package_sha: '6e5203fbdcade4aa4331e441fd2e1db8444681a6a6c72886a37ddd11caa415d4'
    '1.18':  # supported until 1.20 is out
      base_image: 'instructure/core:jammy'
      full_version: '1.18.4'
      package_sha: 'c9b099b68d93f5c5c8a8844a89f8db07eaa58270e3a1e01804f17f4cf8df02f5'
    '1.18-focal':  # if focal is needed
      base_image: 'instructure/core:focal'
      full_version: '1.18.4'
      package_sha: 'c9b099b68d93f5c5c8a8844a89f8db07eaa58270e3a1e01804f17f4cf8df02f5'

graalvm-ce:
  defaults:
    distro: focal
  versions:
    '19-java11':
      java_version: 11
      graal_version: 19.3.5
      package_sha: 4936cdf48cd501e9df7ff41929774bd1cd88aecb41c3fbf2c970b29c340bbc95
    '21-java11':
      java_version: 11
      graal_version: 21.0.0.2
      package_sha: bd3fbe796e803c4fe5cd089371588d3d716fa3cdb653fe8dd6dba31b57bef934
    '22-java17':
      java_version: 17
      graal_version: 22.0.0.2
      package_sha: 4f743e0ed3d974b7d619ca2ed6014554e8c12e5ebbb38b9bc9e820b182169bd4

java:
  defaults:
    base_image: core:bionic
  versions:
    '11':
      java_version: 11
      flavor: jdk
    '11-jre':
      java_version: 11
      flavor: jre
    '16':
      base_image: core:focal
      java_version: 16
      flavor: jdk
    '16-jre':
      base_image: core:focal
      java_version: 16
      flavor: jre
    '17':
      base_image: core:jammy
      java_version: 17
      flavor: jdk
      multiarch: true
    '17-jre':
      base_image: core:jammy
      java_version: 17
      flavor: jre
      multiarch: true
    '18':
      base_image: core:jammy
      java_version: 18
      flavor: jdk
      multiarch: true
    '18-jre':
      base_image: core:jammy
      java_version: 18
      flavor: jre
      multiarch: true
    '17-focal':
      base_image: core:focal
      java_version: 17
      flavor: jdk
      multiarch: true
    '17-jre-focal':
      base_image: core:focal
      java_version: 17
      flavor: jre
      multiarch: true

# We are no longer accepting new minor version tags for Node images, simply
# update the corresponding major version tag (4, 6, 8) to the latest minor.
node: &NODE
  defaults:
    base_distro: focal
    base_image: core:focal
    npm_version: latest
    yarn_version: latest
  versions:
    '12':  # Supported until 04/30/2022
      node_version: '12'
      npm_version: '8.19.3'
      base_distro: bionic
      base_image: core:bionic
    '14':  # Supported until 04/30/2023
      node_version: '14'
      base_distro: focal
      base_image: core:focal
      multiarch: true
    '16':  # Supported until 04/30/2024
      node_version: '16'
      base_distro: focal
      base_image: core:focal
      multiarch: true
    '18':
      node_version: '18'
      base_distro: jammy
      base_image: core:jammy
      multiarch: true

node-passenger:
  versions:
    '12':
      base_distro: bionic
      base_image: node:12
    '14':
      base_distro: focal
      base_image: node:14
      multiarch: true
    '16':
      base_distro: focal
      base_image: node:16
      multiarch: true

node-pm2:
  defaults:
    base_distro: bionic
    base_image: instructure/node:12
  versions:
    '12':
      base_image: instructure/node:12
    '14':
      base_image: instructure/node:14
      base_distro: focal
    '16':
      base_image: instructure/node:16
      base_distro: focal

php: &PHP
  defaults:
    base_image: instructure/core:focal
  versions:
    '7.4': {}

# php-nginx:
  # versions:
    # '7.4': {}

python: &PYTHON
  defaults:
    base_image: instructure/core:bionic
  versions:
    '3.7':
      python_version: 3.7.5
      python_build_version: 3.7
      pip_version: 20.1
      python_pgp_key_id: 0D96DF4D4110E5C43FBFB17F2D347EA6AA65421D
    '3.10':
      python_version: 3.10.4
      python_build_version: '3.10' # Needs to be a string otherwise 0 is removed but we need it
      pip_version: 20.1
      python_pgp_key_id: A035C8C19219BA821ECEA86B64E628F8D684696D
rover:
  defaults:
    base_image:
      name: rust:1.60.0-slim-buster
      source: dockerhub
    multiarch: true
  versions:
    'v0.4.8':
ruby: &RUBY
  defaults:
    base_distro: focal
    base_image: core:focal
    bundler_version: 2.2.6
    rubygems_version: 3.2.6
    multiarch: true
  versions:
    '2.6':
      base_distro: bionic
      base_image: core:bionic
      bundler_version: 1.17.3
      rubygems_version: 2.7.11
      multiarch: false
    '2.7-bionic':
      base_distro: bionic
      base_image: core:bionic
      multiarch: false
    '2.7-jammy':
      base_distro: jammy
      base_image: core:jammy
      multiarch: true
    '2.7':
    '3.0-jammy':
      base_distro: jammy
      base_image: core:jammy
      multiarch: true
    '3.0':
    '3.1-jammy':
      base_distro: jammy
      base_image: core:jammy
      multiarch: true
    '3.1':
    '3.2-jammy':
      base_distro: jammy
      base_image: core:jammy
      multiarch: true
    '3.2':

ruby-node-pg:
  defaults:
    base_distro: bionic
    npm_version: latest
    yarn_version: latest
  versions:
    '2.6-node14':
      node_version: '14'
      ruby_version: '2.6'

ruby-passenger:
  defaults:
    base_distro: focal
    multiarch: true
  versions:
    '2.6':
      base_distro: bionic
      base_image: ruby:2.6
      multiarch: false
    '2.6-p6.0.4':
      base_distro: bionic
      base_image: ruby:2.6
      passenger_version: 1:6.0.4-1~bionic1
      version_override: "2.6"
      multiarch: false
      # https://github.com/phusion/passenger/issues/2281 is blocking some users
    '2.7-bionic':
      base_distro: bionic
      base_image: ruby:2.7-bionic
      multiarch: false
    '2.7':
      base_image: ruby:2.7
    '3.0':
      base_image: ruby:3.0
    '3.1':
      base_image: ruby:3.1
    '3.2':
      base_image: ruby:3.2

scala-sbt:
  defaults:
    base_image: instructure/java:11
  template_files:
    - Dockerfile
    - sbt-private
  versions:
    '1.5':
      full_version: '1.5.5'
      minor_version: '1.5'
      major_version: '1.0'

tini:
  defaults:
    base_image:
      name: alpine
      source: dockerhub
    gpg_key: 595E85A6B1B4779EA4DAAEC70B588DFF0527A9B7
  versions:
    'v0.16.1':
    'v0.18.0':
    'v0.19.0':
      multiarch: true
